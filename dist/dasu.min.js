!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e():"function"==typeof define&&define.amd?define(e):e()}(this,function(){"use strict";function t(t,n){var r="",a=t.data||t.json||"",s="";switch(typeof a){case"object":a.toString==={}.toString?(s=JSON.stringify(a),r="application/json"):(e.debug&&console.log("dasu: complex object data"),s=a,r="application/octet-stream");break;case"string":if(a.length>1&&("{"===a[0]||"["===a[0]))try{JSON.parse(a),console&&console.warn?console.warn("[WARNING] dasu: Sending data that may be JSON as text/plain"):console.log("[WARNING] dasu: Sending data that may be JSON as text/plain")}catch(t){}s=a,r="text/plain";break;default:s=""+a,r="text/plain"}t=Object.assign({},t),delete t.data,r&&(t.headers=Object.assign({},{"content-type":r},t.headers||{}),"application/octet-stream"===r&&s&&s.length&&(t.headers=Object.assign({},{"content-length":s.length},t.headers||{}))),t.method=t.method||"GET",t.path=t.path||"/","/"!==t.path[0]&&(t.path="/"+t.path);var i="http";if(t.port){var p=Number(t.port);String(p)===t.port&&(t.port=p),443===t.port&&(i="https")}t.protocol||(t.protocol=i);var c={protocol:t.protocol,host:t.host,hostname:t.hostname,port:t.port,path:t.path,method:t.method,headers:t.headers};return o(c,s,function(t,e,o){t||void 0===e?n(t):(!e.getResponseHeader&&e.headers&&(e.getResponseHeader=function(t){return e.headers[t]}),e.getAllResponseHeaders&&!e.headers&&(e.headers=e.getAllResponseHeaders()),void 0===e.status?e.status=e.statusCode:e.statusCode=e.status,n(void 0,e,o))})}var e={},o=function(){throw new Error("dasu: No request implemention specified in dasu.js")};if("undefined"!=typeof window&&"undefined"!=typeof window.XMLHttpRequest)o=function(t,o,n){var r=new window.XMLHttpRequest;t.protocol=t.protocol||window.location.protocol||"http",":"!==t.protocol[t.protocol.length-1]&&(t.protocol+=":"),t.hostname=t.hostname||t.host||window.location.hostname;var a=80;t.protocol&&(a=t.protocol.indexOf("https")!==-1?443:80);var s=t.hostname.toLowerCase().trim(),i=window.location.hostname.toLowerCase().trim();s.indexOf(i)!==-1&&(a=window.location.port||a),t.port=t.port||a;var p=t.protocol+"//"+(t.hostname+(t.port?":"+t.port:"")),c=p+t.path;e.debug&&console.log("dasu: url ["+c+"]"),r.open(t.method,c,!0),r.onload=function(){n(null,r,r.responseText)},r.onerror=function(){var e=""+t.method.toUpperCase()+" "+c,a={name:"NetworkError",message:r.responseText||"NetworkError: XMLHttpRequest ("+e+")",desc:e,url:c,opts:t,data:o,origin:p,responseText:r.responseText};a.toString=function(){return a.message+"\n"+JSON.stringify(t,null,2).split(",")},a.message=a.toString(),n(a)};for(var l=Object.keys(t.headers),d=0;d<l.length;d++){var h=l[d].toLowerCase(),u=t.headers[h];r.setRequestHeader(h,u)}try{r.send(o)}catch(e){var g=""+t.method.toUpperCase()+" "+c;e.desc=g,e.url=c,e.opts=t,e.data=o,e.origin=p,e.toString=function(){return e.message+"\n"+JSON.stringify(t,null,2).split(",")},n(e)}return{abort:function(){r.abort()}}};else{var n=require,r=n("http"),a=n("https"),s=n("zlib");o=function(t,o,n){t=t||{},t.hostname=t.hostname||t.host,t.protocol=t.protocol||"http";var i=r;t.protocol&&t.protocol.indexOf("https")!==-1&&(i=a),":"!==t.protocol[t.protocol.length-1]&&(t.protocol+=":"),e.debug&&(console.log("--- dasu opts ---"),console.log(t),console.log());var p=i.request(t,function(t){var e=[],o=t;if(s.createBrotliDecompress&&"br"===t.headers["content-encoding"]){var r=s.createBrotliDecompress();o=r,t.pipe(r)}if(s.createGunzip&&"gzip"===t.headers["content-encoding"]){var a=s.createGunzip();o=a,t.pipe(a)}if(s.createDeflate&&"deflate"===t.headers["content-encoding"]){var i=s.createDeflate();o=i,t.pipe(i)}o.on("data",function(t){e.push(t)}),o.on("end",function(){n(null,t,e.join(""))})});return p.on("error",function(e){var r=t.protocol+"//"+(t.hostname+(t.port?":"+t.port:"")),a=r+t.path,s=""+t.method.toUpperCase()+" "+a;e.desc=s,e.url=a,e.opts=t,e.data=o,e.origin=r,e.toString=function(){return e.message+"\n"+JSON.stringify(t,null,2).split(",")},e.message=e.toString(),n(e)}),e.debug&&(console.log("dasu typeof dataString: "+typeof o),o&&o.length>=0&&console.log("dasu sending length: "+o.length)),p.write(o),p.end(),{abort:function(){p.abort()}}}}e.xhr=function(e,o){t(e,function(t,e,n){o(t,n)})},e.req=t,module.exports=e});