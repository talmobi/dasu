!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(this,function(){"use strict";function e(e,t,o){n._mode="browser";var r=new window.XMLHttpRequest;e.protocol=e.protocol||window.location.protocol||"http",":"!==e.protocol[e.protocol.length-1]&&(e.protocol+=":"),e.hostname=e.hostname||e.host||window.location.hostname;var a=80;e.protocol&&(a=e.protocol.indexOf("https")!==-1?443:80);var s=e.hostname.toLowerCase().trim(),p=window.location.hostname.toLowerCase().trim();s.indexOf(p)!==-1&&(a=window.location.port||a),e.port=e.port||a;var i=e.protocol+"//"+(e.hostname+(e.port?":"+e.port:"")),l=i+e.path;n.debug&&console.log("dasu: url ["+l+"]"),r.open(e.method,l,!0),r.onload=function(){o(null,r,r.responseText)},r.onerror=function(){var n=""+e.method.toUpperCase()+" "+l,a={name:"NetworkError",message:r.responseText||"NetworkError: XMLHttpRequest ("+n+")",desc:n,url:l,opts:e,data:t,origin:i,responseText:r.responseText};a.toString=function(){return a.message+"\n"+JSON.stringify(e,null,2).split(",")},a.message=a.toString(),o(a)};for(var d=Object.keys(e.headers),c=0;c<d.length;c++){var h=d[c].toLowerCase(),u=e.headers[h];r.setRequestHeader(h,u)}try{r.send(t)}catch(n){var f=""+e.method.toUpperCase()+" "+l;n.desc=f,n.url=l,n.opts=e,n.data=t,n.origin=i,n.toString=function(){return n.message+"\n"+JSON.stringify(e,null,2).split(",")},o(n)}return{abort:function(){r.abort()}}}function t(e,t,o){n._mode="node";var r=require,a=r("http"),s=r("https"),p=r("zlib");e=e||{},e.hostname=e.hostname||e.host,e.protocol=e.protocol||"http";var i=a;e.protocol&&e.protocol.indexOf("https")!==-1&&(i=s),":"!==e.protocol[e.protocol.length-1]&&(e.protocol+=":"),n.debug&&(console.log("--- dasu opts ---"),console.log(e),console.log());var l=i.request(e,function(e){var t=[],n=e;if(p.createBrotliDecompress&&"br"===e.headers["content-encoding"]){var r=p.createBrotliDecompress();n=r,e.pipe(r)}if(p.createGunzip&&"gzip"===e.headers["content-encoding"]){var a=p.createGunzip();n=a,e.pipe(a)}if(p.createDeflate&&"deflate"===e.headers["content-encoding"]){var s=p.createDeflate();n=s,e.pipe(s)}n.on("data",function(e){t.push(e)}),n.on("end",function(){var n=t.join("");e.responseText=e.responseText||n,o(null,e,n)})});return l.on("error",function(n){var r=e.protocol+"//"+(e.hostname+(e.port?":"+e.port:"")),a=r+e.path,s=""+e.method.toUpperCase()+" "+a;n.desc=s,n.url=a,n.opts=e,n.data=t,n.origin=r,n.toString=function(){return n.message+"\n"+JSON.stringify(e,null,2).split(",")},n.message=n.toString(),o(n)}),n.debug&&(console.log("dasu typeof dataString: "+typeof t),t&&t.length>=0&&console.log("dasu sending length: "+t.length)),l.write(t),l.end(),{abort:function(){l.abort()}}}function o(o,a){function s(e,t,i){if(e||void 0===t)a(e);else{if(!t.getResponseHeader&&t.headers&&(t.getResponseHeader=function(e){return t.headers[e]}),t.getAllResponseHeaders&&!t.headers&&(t.headers=t.getAllResponseHeaders()),!t.getAllResponseHeaders&&t.headers&&(t.getAllResponseHeaders=function(){return t.headers}),void 0===t.status?t.status=t.statusCode:t.statusCode=t.status,n.follow&&t.status>=300&&t.status<400&&t.headers.location&&f<g){f++;var l=t.headers.location;if("//"===l.slice(0,2)&&(l=o.protocol+":"+l),"/"===l[0])return u.path=l,r(u,d,s);var c;if("undefined"!=typeof URL)c=new URL(l);else if("node"===p){var h=require;c=h("url").parse(l)}if(c)return u.protocol=c.protocol&&c.protocol,u.host=c.host&&c.host,u.hostname=c.hostname&&c.hostname,u.port=c.port&&c.port,u.path=c.path&&c.path,r(u,d,s)}a(void 0,t,i)}}var p;"browser"===n.mode||"node"!==n.mode&&"undefined"!=typeof window&&"undefined"!=typeof window.XMLHttpRequest?(p="browser",r=e):(p="node",r=t);var i="",l=o.data||o.json||"",d="";switch(typeof l){case"object":l.toString==={}.toString?(d=JSON.stringify(l),i="application/json"):(n.debug&&console.log("dasu: complex object data"),d=l,i="application/octet-stream");break;case"string":if(l.length>1&&("{"===l[0]||"["===l[0]))try{JSON.parse(l),console&&console.warn?console.warn("[WARNING] dasu: Sending data that may be JSON as text/plain"):console.log("[WARNING] dasu: Sending data that may be JSON as text/plain")}catch(e){}d=l,i="text/plain";break;default:d=""+l,i="text/plain"}o=Object.assign({},o),delete o.data,i&&(o.headers=Object.assign({},{"content-type":i},o.headers||{}),"application/octet-stream"===i&&d&&d.length&&(o.headers=Object.assign({},{"content-length":d.length},o.headers||{}))),o.method=o.method||"GET",o.path=o.path||"/","/"!==o.path[0]&&(o.path="/"+o.path);var c="http";if(o.port){var h=Number(o.port);String(h)===o.port&&(o.port=h),443===o.port&&(c="https")}o.protocol||(o.protocol=c);var u={protocol:o.protocol,host:o.host,hostname:o.hostname,port:o.port,path:o.path,method:o.method,headers:o.headers},f=0,g=3;return r(u,d,s)}var n={follow:!0,mode:"auto"},r=function(){throw new Error("dasu: no _request implementation found!")};n.xhr=function(e,t){o(e,function(e,o,n){t(e,n)})},n.req=o,module.exports=n});