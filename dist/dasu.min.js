!function(e,o){"object"==typeof exports&&"undefined"!=typeof module?o():"function"==typeof define&&define.amd?define(o):o()}(this,function(){"use strict";function e(e,o,t){n._mode="browser";var r=new window.XMLHttpRequest;e.protocol=e.protocol||window.location.protocol||"http",":"!==e.protocol[e.protocol.length-1]&&(e.protocol+=":"),e.hostname=e.hostname||e.host||window.location.hostname;var s=80;e.protocol&&(s=e.protocol.indexOf("https")!==-1?443:80);var a=e.hostname.toLowerCase().trim(),p=window.location.hostname.toLowerCase().trim();a.indexOf(p)!==-1&&(s=window.location.port||s),e.port=e.port||s;var l=e.protocol+"//"+(e.hostname+(e.port?":"+e.port:"")),i=l+e.path;n.debug&&console.log("dasu: url ["+i+"]"),n.debug&&(console.log("--- dasu opts ---"),console.log(e),console.log()),r.open(e.method,i,!0),r.onload=function(){t(null,r,r.responseText)},r.onerror=function(){var n=""+e.method.toUpperCase()+" "+i,s={name:"NetworkError",message:r.responseText||"NetworkError: XMLHttpRequest ("+n+")",desc:n,url:i,opts:e,data:o,origin:l,responseText:r.responseText};s.toString=function(){return s.message+"\n"+JSON.stringify(e,null,2).split(",")},s.message=s.toString(),t(s)};for(var d=Object.keys(e.headers),c=0;c<d.length;c++){var h=d[c].toLowerCase(),u=e.headers[h];r.setRequestHeader(h,u)}try{r.send(o)}catch(n){var g=""+e.method.toUpperCase()+" "+i;n.desc=g,n.url=i,n.opts=e,n.data=o,n.origin=l,n.toString=function(){return n.message+"\n"+JSON.stringify(e,null,2).split(",")},t(n)}return{abort:function(){r.abort()}}}function o(e,o,t){n._mode="node";var s=r("http"),a=r("https"),p=r("zlib");e=e||{},e.hostname=e.hostname||e.host,e.protocol=e.protocol||"http";var l=s;e.protocol&&e.protocol.indexOf("https")!==-1&&(l=a),":"!==e.protocol[e.protocol.length-1]&&(e.protocol+=":"),n.debug&&(console.log("--- dasu opts ---"),console.log(e),console.log());var i=l.request(e,function(e){var o=[],n=e;if(p.createBrotliDecompress&&"br"===e.headers["content-encoding"]){var r=p.createBrotliDecompress();n=r,e.pipe(r)}if(p.createGunzip&&"gzip"===e.headers["content-encoding"]){var s=p.createGunzip();n=s,e.pipe(s)}if(p.createDeflate&&"deflate"===e.headers["content-encoding"]){var a=p.createDeflate();n=a,e.pipe(a)}n.on("data",function(e){o.push(e)}),n.on("end",function(){var n=o.join("");e.responseText=e.responseText||n,t(null,e,n)})});return i.on("error",function(n){var r=e.protocol+"//"+(e.hostname+(e.port?":"+e.port:"")),s=r+e.path,a=""+e.method.toUpperCase()+" "+s;n.desc=a,n.url=s,n.opts=e,n.data=o,n.origin=r,n.toString=function(){return n.message+"\n"+JSON.stringify(e,null,2).split(",")},n.message=n.toString(),t(n)}),n.debug&&(console.log("dasu typeof dataString: "+typeof o),o&&o.length>=0&&console.log("dasu sending length: "+o.length)),i.write(o),i.end(),{abort:function(){i.abort()}}}function t(t,a){function p(e,o,i){if(e||void 0===o)a(e);else{if(!o.getResponseHeader&&o.headers&&(o.getResponseHeader=function(e){return o.headers[e]}),o.getAllResponseHeaders&&!o.headers&&(o.headers=o.getAllResponseHeaders()),!o.getAllResponseHeaders&&o.headers&&(o.getAllResponseHeaders=function(){return o.headers}),void 0===o.status?o.status=o.statusCode:o.statusCode=o.status,n.debug&&(n.log+="\n-------------\n",n.log+=new Date,n.log+="headers:\n"+JSON.stringify(o.headers,null,2)+"\n\n",n.log+="body:\n"+i+"\n"),n.follow&&o.status>=300&&o.status<400&&o.headers.location&&m<w){m++;var d=o.headers.location;if("//"===d.slice(0,2)&&(d=t.protocol+":"+d),"/"===d[0])return f.path=d,s(f,h,p);var c;if("undefined"!=typeof URL?c=new URL(d):"node"===l&&(c=r("url").parse(d)),n.debug)if("node"===l)try{var u=r("fs");u.writeFileSync("debug.dasu-response.log",n.log,"utf8")}catch(e){}else console.log(n.log);if(c)return f.protocol=c.protocol&&c.protocol,f.host=c.host&&c.host,f.hostname=c.hostname&&c.hostname,f.port=c.port&&c.port,f.path=c.path&&c.pathname,s(f,h,p)}a(void 0,o,i)}}var l;if("browser"===n.mode||"node"!==n.mode&&"undefined"!=typeof window&&"undefined"!=typeof window.XMLHttpRequest?(l="browser",s=e):(l="node",s=o),"string"==typeof t){var i;"undefined"!=typeof URL?i=new URL(t):"node"===l&&(i=r("url").parse(t)),t={},t.method="GET",t.protocol=i.protocol,t.host=i.host,t.hostname=i.hostname,t.port=i.port,t.path=i.path||i.pathname}var d="",c=t.data||t.json||"",h="";switch(typeof c){case"object":c.toString==={}.toString?(h=JSON.stringify(c),d="application/json"):(n.debug&&console.log("dasu: complex object data"),h=c,d="application/octet-stream");break;case"string":if(c.length>1&&("{"===c[0]||"["===c[0]))try{JSON.parse(c),console&&console.warn?console.warn("[WARNING] dasu: Sending data that may be JSON as text/plain"):console.log("[WARNING] dasu: Sending data that may be JSON as text/plain")}catch(e){}h=c,d="text/plain";break;default:h=""+c,d="text/plain"}t=Object.assign({},t),delete t.data,d&&(t.headers=Object.assign({},{"content-type":d},t.headers||{}),"application/octet-stream"===d&&h&&h.length&&(t.headers=Object.assign({},{"content-length":h.length},t.headers||{}))),t.method=t.method||"GET",t.path=t.path||"/","/"!==t.path[0]&&(t.path="/"+t.path);var u="http";if(t.port){var g=Number(t.port);String(g)===t.port&&(t.port=g),443===t.port&&(u="https")}t.protocol||(t.protocol=u);var f={protocol:t.protocol,host:t.host,hostname:t.hostname,port:t.port,path:t.path,method:t.method,headers:t.headers},m=0,w=3;return n.log="",s(f,h,p)}var n={follow:!0,mode:"auto"},r=require,s=function(){throw new Error("dasu: no _request implementation found!")};n.xhr=function(e,o){t(e,function(e,t,n){o(e,n)})},n.req=t,module.exports=n});